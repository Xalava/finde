<!DOCTYPE html>
<html lang="en" style="overscroll-behavior-x: none;">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no" />
    <title>Financial Defense</title>
    <link rel="stylesheet" href="style.css" />
    <meta name="description" content="A game to understand payments and compliance.">
</head>

<body>
    <div id="app-container">
        <header id="topbar">
            <div class="logo">
                <span class="icon">üíº</span>
                <span class="title">Financial Defense</span>
            </div>
            <div class="stat-item" data-tooltip="Current game day">
                <span class="stat-icon">üóìÔ∏è</span>
                <strong class="ui-name">Day</strong>
                <span id="day">0</span><span id="holiday"></span>
            </div>
            <button id="research-button" class="stat-item command-button hidden" data-tooltip="Technology Tree">
                <span class="stat-icon">üß™</span>
                <strong class="ui-name">Research</strong>
                <span id="research-points">0</span>
            </button>
            <button id="stat-button" class="stat-item command-button hidden" data-tooltip="Transaction and detection statistics">
                <span class="stat-icon">üìä</span>
                <strong class="ui-name">Stats</strong>
            </button>
            <button id="policy-button" class="stat-item command-button hidden" data-tooltip="Policy decisions">
                <span class="stat-icon">üìú</span>
                <strong class="ui-name">Policies</strong>
                <span id="policy-status">‚öñÔ∏è</span>
            </button>
            <div id="separator"></div>
            <!-- disabled -->
            <!-- <div id="tx-stat-item" class="stat-item hidden" data-tooltip="Ongoing transactions.">
                <span class="stat-icon">‚ÜîÔ∏è</span>
                <strong class="ui-name">Transactions</strong>
            </div> -->
            <div class="stat-item" data-tooltip="Available operational budget">
                <span class="stat-icon">üí∞</span>
                <strong class="ui-name">Budget</strong>
                <span id="budget">90</span>
            </div>
            <div id="maintenance-stat-item" class="stat-item hidden" data-tooltip="Ongoing system maintenance costs per second">
                <span class="stat-icon">üõ†Ô∏è</span>
                <strong class="ui-name">Upkeep</strong>
                <span id="maintenance">0</span>
            </div>

        </header>

        <main id="game-container">
            <canvas id="game"></canvas>
            <!-- Transaction Tooltip Overlay -->
            <div id="transaction-tooltip" class="panel hidden">
                <div id="tooltip-content" class=""></div>
                <div id="tooltip-motive" class=""></div>
                <div id="tooltip-actions">
                    <button id="tooltip-allow" class="tx-button primary">
                        <span class="tx-button-icon">‚úÖ</span>
                        <span class="tx-button-name">Allow</span>
                    </button>
                    <button id="tooltip-freeze" class="tx-button">
                        <span class="tx-button-icon">ü•∂</span>
                        <span class="tx-button-name">Freeze</span>
                    </button>
                    <button id="tooltip-block" class="tx-button errory">
                        <span class="tx-button-icon">üõë</span>
                        <span class="tx-button-name">Block</span>
                    </button>
                </div>
            </div>

            <aside id="node-details-panel" class="panel hidden">
                <div class="panel-header">
                    <h2 id="panel-title">Node Name</h2>
                    <button id="close-panel" class="close-button">√ó</button>
                </div>
                <div class="panel-content">
                    <div id="overview-tab" class="tab-content">
                        <section class="panel-section">
                            <h3 style="display: flex;">
                                Reputation
                                <span id="reputation-value">80</span>
                            </h3>

                            <div class="bar-container">
                                <div class="bar-fill good" id="reputation-bar" style="width: 80%"></div>
                            </div>
                        </section>

                        <details class="node-details">
                            <summary>Details</summary>
                            <div class="detail-row">
                                <span class="detail-label">Type of institution</span>
                                <span class="detail-value" id="panel-type">Bank</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Country</span>
                                <span id="country-name"></span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Corruption Level</span>
                                <span class="detail-value" id="panel-corruption">0</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Total Funds Processed</span>
                                <span>$ <span class="detail-value" id="panel-received">0</span></span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Illegal Funds Seized</span>
                                <span>$ <span class="detail-value" id="panel-detected">0</span></span>
                            </div>
                        </details>

                        <section class="panel-section">
                            <h3>Control Systems</h3>
                            <div id="tower-options" class="options-section"></div>
                            <br>
                            <h3>Enforcement</h3>
                            <div id="action-options" class="options-section"></div>
                        </section>
                    </div>
                </div>
            </aside>

            <aside id="user-details-panel" class="panel hidden">
                <div class="panel-header">
                    <h2 id="user-name">User</h2>

                    <button id="close-user-panel" class="close-button">√ó</button>
                </div>
                <div class="panel-content">
                    <div id="user-summary">
                        <span id="user-type"></span> in <span id="user-country"></span> <span id="user-badge"></span>

                    </div>
                    <div class="transaction-section">
                        <h3>Ongoing Transactions</h3>
                        <div id="user-transactions" class="transaction-list">
                            <div class="no-transactions">No pending sent transactions</div>
                        </div>
                    </div>
                </div>
            </aside>
        </main>

        <aside id="tutorial" class="panel hidden">
            <div id="tutorial-header" class="panel-header">
                <h2 id="tutorial-title"></h2>
            </div>
            <div id="tutorial-content" class="panel-content"></div>
            <div class="panel-footer">
                <div id="tutorial-buttons"></div>
                <div id="tutorial-progress-container">
                    <div id="tutorial-progress"></div>
                </div>
            </div>
        </aside>

        <aside id="instructions" class="panel hidden">
            <div class="panel-header">
                <h3>üíº Financial Defense</h3>
                <button class="close-button" id="close-instructions">√ó</button>
            </div>
            <div class="instruction-content">
                <p>Monitor and secure the financial network against illegal transactions and corruption.</p>

                <h3>Controls:</h3>
                <ul>
                    <li><strong>Click</strong> on any node to view details and act</li>
                    <li>Install <strong>filters</strong> to detect illegal transactions</li>
                    <li>Trigger <strong>audits</strong> to reduce existing corruption</li>
                    <li>Research <strong>AI Systems</strong> for better accuracy but maintenance costs</li>
                </ul>

                <h3>Game Objectives:</h3>
                <ul>
                    <li>Prevent the spread of corruption throughout the network</li>
                    <li>Allow the development of a thriving ecosystem</li>
                </ul>
                <h3>Game mechanics:</h3>
                <ul>
                    <li>Holidays result in more transactions</li>
                    <li>Entities with higher corruption produce more illegal transactions</li>
                </ul>
                <div style="margin-top: 20px; text-align: center;">
                    <button id="restart-tutorial">üéì Restart Tutorial</button>
                </div>
            </div>
        </aside>
        <aside id="research-panel" class="panel command-panel hidden">
            <div class="panel-header">
                <h2>Research</h2>
                <button id="close-research" class="close-button">√ó</button>
            </div>
            <div class="panel-tabs">
                <button class="tab-button active" data-tab="compliance">Compliance</button>
                <button class="tab-button" data-tab="enforcement">Enforcement</button>
                <button class="tab-button" data-tab="network">Network</button>
            </div>
            <div class="panel-content">
                <div id="tech-tree-container"></div>
            </div>
        </aside>
        <aside id="policy-panel" class="panel command-panel hidden">
            <div class="panel-header">
                <h2>Policy</h2>
                <button id="close-policy" class="close-button">√ó</button>
            </div>
            <div class="panel-content">
                <section class="panel-section">
                    <h3>üó≥Ô∏è Your Ecosystem Popularity</h3>
                    <!-- <div id="popularity-wrap" data-tooltip="Updates regularly based on policy level and changes">
                        <div id="popularity-bar"></div>
                    </div> -->
                    <div>
                        <em>Œî <span id="policy-points">0</span> per quarter</em>
                    </div>
                </section>
                <br>
                <section class="panel-section policy-row" data-tooltip="Set the compliance level.">
                    <label class="policy-option">
                        <span class="policy-icon">üåø</span>
                        <strong>Lenient</strong>
                        <span class="policy-hint">Fewer false positives, but less detection</span>
                        <input type="radio" name="reg" value="lenient">
                    </label>
                    <label class="policy-option">
                        <span class="policy-icon">‚öñÔ∏è</span>
                        <strong>Balanced</strong>
                        <span class="policy-hint">Default policy. No impact on popularity</span>
                        <input type="radio" name="reg" value="balanced" checked>
                    </label>
                    <label class="policy-option">
                        <span class="policy-icon">üîí</span>
                        <strong>Stringent</strong>
                        <span class="policy-hint">More detection, but more false positives</span>
                        <input type="radio" name="reg" value="stringent">
                    </label>
                </section>
                <section class="panel-section" data-tooltip="Set the fee level.">
                    <h3>üí∞Ô∏è Fee Level</h3>
                    <div class="tax-slider-wrapper">
                        <label for="taxation-slider">Rate: <span id="taxation-value">4</span>%</label>
                        <input type="range" id="taxation-slider" name="taxation" min="0" max="20" value="4" class="policy-slider">
                    </div>
                </section>
                <section class="panel-section" data-tooltip="Require minimum filter compliance for banks. Non-compliant banks trigger automated tower placement.">
                    <h3>üè¶ Minimal Compliance</h3>
                    <p class="policy-hint">Banks will be required to install compliant
                        filters automatically. Have the appropriate budget ready.</p>
                    <br>
                    <select id="compliance-select" class="compliance-select">
                        <option value="0">None - No requirements</option>
                        <option value="1">Basic filter required</option>
                        <option value="2">Medium filter required</option>
                        <!-- <option value="3">High level filter required</option> -->
                    </select>
                </section>
                <section class="panel-section" data-tooltip="Manual approval for new nodes; more control, slower expansion">
                    <label class="policy-checkbox">
                        <input type="checkbox" id="approvals-policy">
                        <strong>Mandatory Approvals</strong>
                        <span class="policy-hint">Gate new actors</span>
                    </label>
                </section>

                <section class="panel-section" id="approvals"></section>
            </div>
        </aside>

    </div>

    <div id="toast-container">
        <!-- Notification toasts will be added here dynamically -->
    </div>

    <div class="game-controls" id="game-controls">
        <div class="left-controls">
            <button id="toggle-instructions">‚ùî <span class="ui-name">Explanations</span></button>
        </div>
        <button id="center-view">‚≠ïÔ∏è <span class="ui-name">Center</span></button>
        <div id="debug-controls" class="hidden">
            <button id="toggle-debug">üîß <span class="ui-name">Debug</span></button>
        </div>
        <button id="restart-game" class="hidden">üîÑ <span class="ui-name">Restart</span></button>
        <button id="toggle-countries">üá∫üá≥ <span class="ui-name">Countries</span></button>
        <button id="toggle-heatmap" class="hidden">üå°Ô∏è <span class="ui-name">Heatmap</span></button>
        <div>
            <button id="slow">‚èØÔ∏è</button>
            <button id="normal">‚ñ∂Ô∏è</button>
            <button id="fast">‚è©Ô∏è</button>
        </div>
    </div>

    <!-- Transaction template for JavaScript use -->
    <template id="transaction-template">
        <div class="transaction-item" data-tx-id="">
            <div class="transaction-amount"></div>
            <div class="transaction-parties"></div>
            <div class="transaction-status"></div>
        </div>
    </template>
    <script src="./js/main.js" type="module"></script>
</body>

</html>